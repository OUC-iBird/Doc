# API Document

这是中国海洋大学 2020 年软件工程课程设计 iBird 项目的接口文档。

## 总体

以下为对所有接口的总体概述

### 域名

域名为 https://weparallelines.top

**注意：** 使用 HTTPS

### 接口格式

接口的请求格式一般为 JSON 格式，少数为 MultiForm 格式。

接口的响应格式为 JSON 格式。

### 接口访问频率

接口访问频率有 3 级限制

- 严格：2 秒 2 次
- 中等：1 秒 2 次
- 宽松：1 秒 5 次

超过访问频率会返回 50403 "Forbidden"。

### 响应字段

响应字段必定包含**状态码 code** 和**状态信息 msg**。

其他额外字段均包含在**数据 data** 字段中。

**注意：** 以下所有接口的响应字段除 code 和 msg 字段均在 data 字段中，为了书写文档简便其他字段与 code 和 msg 字段并列。

### 响应状态码和状态信息

响应状态码 code 和状态信息 msg 一一对应，无重复。

未详尽的状态码和状态信息参考 https://github.com/OUC-iBird/iBird_Back_End/blob/main/apps/utils/response_status.py

## 接口

### 上传图片

**接口功能**

> 上传图片

**URL**

> /api/upload

**访问频率限制**

> 严格：2 秒 1 次

**请求方式**

> POST

**请求格式**

> MultiForm

**请求字段**

> | 参数  | 必选 | 类型   | 说明                                 |
> | :---- | :--- | :----- | ------------------------------------ |
> | img   | true | file   | 图片文件（jpg、png）                 |
> | usage | true | string | 用途（”p“: 上传图片、"a": 上传头像） |

**响应格式**

> JSON

**响应字段**

> | 返回字段 | 字段类型 | 说明     |
> | :------- | :------- | :------- |
> | code     | int      | 状态码   |
> | msg      | string   | 状态信息 |
> | path     | string   | 图片路径 |

**响应状态码与状态信息**

> - 20000: 成功
>
> - 50000: 意外错误
>
> - 50403: Forbidden
>
>   
>
> - 40000: 请求方法错误
>
> - 41007: 缺少图片
>
> - 41008: 缺少用途
>
> - 42010: 图片用途错误
>
> - 42011: 图片大小不得超过 5MB
>
> - 42012: 图片仅支持 jpg, png 格式
>

**示例**

```json
// request MultiForm
{
  "img": "file",
  "usage": "p"
}

// response JSON
{
    "code": 20000,
    "msg": "成功",
    "data": {
        "path": "/picture/20201127172407i3xm4nhx23.png"
    }
}
```

---

### 识别鸟类

**接口功能**

> 根据图片识别鸟的种类

**URL**

> /api/prediction/predict

**访问频率限制**

> 严格：2 秒 1 次

**请求方式**

> POST

**请求格式**

> JSON

**请求字段**

> | 参数 | 必选 | 类型   | 说明                                       |
> | :--- | :--- | :----- | ------------------------------------------ |
> | path | true | string | 图片文件在服务器的路径（上传图片时获取的） |

**响应格式**

> JSON

**响应字段**

> | 返回字段 | 字段类型 | 说明                                                         |
> | :------- | :------- | :----------------------------------------------------------- |
> | code     | int      | 状态码                                                       |
> | msg      | string   | 状态信息                                                     |
> | sequence | int      | 预测报告序列号                                               |
> | path     | string   | 图片路径                                                     |
> | result   | array    | 识别结果列表（具体内容类型参考示例，[鸟类名称、鸟类编号、置信度]） |

**响应状态码与状态信息**

> - 20000: 成功
>
> - 50000: 意外错误
>
> - 50403: Forbidden
>
>   
>
> - 40000: 请求方法错误
>
> - 41009: 缺少图片路径
>
> - 43006: 图片路径不存在

**示例**

```json
// request MultiForm
{
    "path": "/picture/20201130211502ltsuo9hsrq.jpg"
}

// response JSON
{
    "code": 20000,
    "msg": "成功",
    "data": {
        "sequence": 5,
        "path": "/picture/default.png",
        "result": [
            {
                "label": "白鸥",
                "id": 63,
                "probability": 0.32865774631500244
            },
            {
                "label": "红腿三趾鸥",
                "id": 84,
                "probability": 0.10061699151992798
            },
            {
                "label": "布兰德鸬鹚",
                "id": 23,
                "probability": 0.06324422359466553
            },
            {
                "label": "乌黑信天翁",
                "id": 3,
                "probability": 0.0570412278175354
            },
            {
                "label": "环鸥",
                "id": 62,
                "probability": 0.05208071321249008
            }
        ]
    }
}
```

---

