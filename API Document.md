# API Document

这是中国海洋大学 2020 年软件工程课程设计 iBird 项目的接口文档。

## 总体

以下为对所有接口的总体概述

### 域名

域名为 https://weparallelines.top

**注意：** 使用 HTTPS

### 接口格式

接口的请求格式一般为 JSON 格式，少数为 MultiForm 格式。

接口的响应格式为 JSON 格式。

### 响应字段

响应字段必定包含**状态码 code** 和**状态信息 msg**。

其他额外字段均包含在**数据 data** 字段中。

**注意：** 以下所有接口的响应字段除 code 和 msg 字段均在 data 字段中，为了书写文档简便其他字段与 code 和 msg 字段并列。

### 响应状态码和状态信息

响应状态码 code 和状态信息 msg 一一对应，无重复。

未详尽的状态码和状态信息参考 https://github.com/OUC-iBird/iBird_Back_End/blob/main/apps/utils/response_status.py

## 接口

### 上传图片

**接口功能**

> 上传图片

**URL**

> /api/upload

**请求方式**

> POST

**请求格式**

> MultiForm

**请求字段**

> | 参数  | 必选 | 类型   | 说明                                 |
> | :---- | :--- | :----- | ------------------------------------ |
> | img   | true | file   | 图片文件（jpg、png）                 |
> | usage | true | string | 用途（”p“: 上传图片、"a": 上传头像） |

**响应格式**

> JSON

**响应字段**

> | 返回字段 | 字段类型 | 说明     |
> | :------- | :------- | :------- |
> | code     | int      | 状态码   |
> | msg      | string   | 状态信息 |
> | path     | string   | 图片路径 |

**响应状态码与状态信息**

> - 20000: 成功
>
> - 50000: 意外错误
>
>   
>
> - 40000: 请求方法错误
>
> - 41007: 缺少图片
>
> - 41008: 缺少用途
>
> - 42010: 图片用途错误
>
> - 42011: 图片大小不得超过 5MB
>
> - 42012: 图片仅支持 jpg, png 格式
>

**示例**

```json
// request MultiForm
{
  "img": "file",
  "usage": "p"
}

// response JSON
{
    "code": 20000,
    "msg": "成功",
    "data": {
        "path": "/picture/20201127172407i3xm4nhx23.png"
    }
}
```

---

### 识别鸟类

**接口功能**

> 根据图片识别鸟的种类

**URL**

> /api/prediction/predict

**请求方式**

> POST

**请求格式**

> JSON

**请求字段**

> | 参数 | 必选 | 类型   | 说明                                       |
> | :--- | :--- | :----- | ------------------------------------------ |
> | path | true | string | 图片文件在服务器的路径（上传图片时获取的） |

**响应格式**

> JSON

**响应字段**

> | 返回字段 | 字段类型 | 说明                                                         |
> | :------- | :------- | :----------------------------------------------------------- |
> | code     | int      | 状态码                                                       |
> | msg      | string   | 状态信息                                                     |
> | sequence | int      | 预测报告序列号                                               |
> | path     | string   | 图片路径                                                     |
> | result   | array    | 识别结果列表（具体内容类型参考示例，[鸟类名称、鸟类编号、置信度]） |

**响应状态码与状态信息**

> - 20000: 成功
>
> - 50000: 意外错误
>
>   
>
> - 40000: 请求方法错误
>
> - 41009: 缺少图片路径
>
> - 43006: 图片路径不存在

**示例**

```json
// request MultiForm
{
    "path": "/picture/20201130211502ltsuo9hsrq.jpg"
}

// response JSON
{
    "code": 20000,
    "msg": "成功",
    "data": {
        "sequence": 1,
        "path": "/picture/20201130211502ltsuo9hsrq.jpg",
        "result": [
            [
                "麻雀",
                118,
                0.5456504225730896
            ],
            [
                "树雀",
                130,
                0.3957599103450775
            ],
            [
                "崖燕",
                137,
                0.02549450285732746
            ],
            [
                "褐斑翅雀鹀",
                116,
                0.020729750394821167
            ],
            [
                "黑喉麻雀",
                114,
                0.0020368301775306463
            ]
        ]
    }
}
```

---

